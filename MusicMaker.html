<html>
<body>
<h1>Hello World!</h1>

<script>
let tempos = [80, 100, 120];
let timeSignatures = [{
  signature: "4/4", 
  barLength: 16,
  noteSchemes: [
    [16],
	[4, 12],
	[8, 8],
	[2, 2, 12],
	[4, 4, 8],
	[2, 2, 4, 8],
	[2, 4, 2, 8],
	[4, 2, 2, 8],
	[2, 2, 2, 2, 8],
	[2, 2, 4, 4, 4],
	[2, 4, 2, 4, 4],
	[2, 2, 2, 2, 4, 4],
	[2, 2, 2, 4, 2, 4],
	[2, 2, 2, 2, 2, 2, 4],
  ],
  drumSchemes: {
    kick: [[1], [1, 2], [1, 3], [1, 1.5, 3, 3.5]],
	snare: [[3], [2, 4]],
	highhat: [[1, 2, 3, 4], [1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5]]
  }
}, {
  signature: "3/4", 
  barLength: 12,
  noteSchemes: [
	[12],
	[4, 8],
	[2, 2, 8],
	[2, 2, 4, 4],
	[2, 2, 2, 2, 4],
  ],
  drumSchemes: {
    kick: [[1], [1, 2], [1, 1.5], [1, 1.5, 2, 2.5]],
	snare: [[2], [3], [2, 3]],
	highhat: [[1, 2, 3], [1, 1.5, 2, 2.5, 3, 3.5]]
  }
}];
let notes = ["Bb", "B", "C", "Db", "D", "Eb", "E", "F", "F#", "G", "Ab", "A", "Bb", "B", "C", "Db", "D", "Eb", "E", "F", "F#", "G", "Ab", "A"];
let steps = [[3, 4], [3, 5], [4, 3], [4, 5], [5, 3], [5, 4]];
let directions = [[-1, 1], [1, -1]];

let selectedTempo = tempos[Math.floor(Math.random() * tempos.length)];
let selectedTimeSignature = timeSignatures[Math.floor(Math.random() * timeSignatures.length)];
let selectedStartNoteIndex = Math.floor(Math.random() * (notes.length / 2));
let selectedSteps = steps[Math.floor(Math.random() * steps.length)];
let selectedNotes = [notes[selectedStartNoteIndex], notes[selectedStartNoteIndex + selectedSteps[0]], notes[selectedStartNoteIndex + selectedSteps[0] + selectedSteps[1]]];
let selectedDirection = directions[Math.floor(Math.random() * directions.length)];
let shouldSwap = Math.floor(Math.random() * 2);

console.log("selectedTempo", selectedTempo);
console.log("selectedTimeSignature", selectedTimeSignature);
console.log("selectedNotes", selectedNotes);
console.log("selectedDirection", selectedDirection);
console.log("shouldSwap", shouldSwap);

let melodys = [[], [], [], [], [], []];
for(let j = 0; j < 6; j++) {
  let selectedNoteScheme = selectedTimeSignature.noteSchemes[Math.floor(Math.random() * selectedTimeSignature.noteSchemes.length)];
  let note;
  let lastNote;
  for(let k = 0; k < 4; k++) {
    let barArray = [];
    for(let i = 0; i < selectedNoteScheme.length; i++) {
      let noteLength = selectedNoteScheme[i];
      while(note === lastNote) {
	    note = selectedNotes[Math.floor(Math.random() * selectedNotes.length)];
	  }
	  lastNote = note;
      barArray.push({note: note, noteLength: noteLength});
    }
	melodys[j].push(barArray);
  }
  melodys[j].sort((a, b) => {
    for(let i = a.length - 1; i >= 0; i--) {
	  if(selectedNotes.indexOf(a[i].note) < selectedNotes.indexOf(b[i].note)) {
	    return selectedDirection[0];
	  }
	  if(selectedNotes.indexOf(a[i].note) > selectedNotes.indexOf(b[i].note)) {
	    return selectedDirection[1];
	  }
	}
	return 0;
  });
  if(shouldSwap === 1) {
	let tempBar = melodys[j][2];
	melodys[j][2] = melodys[j][3];
	melodys[j][3] = tempBar;
  }
}

console.log("melodys", melodys);

let kick = selectedTimeSignature.drumSchemes.kick;
let snare = selectedTimeSignature.drumSchemes.snare;
let highhat = selectedTimeSignature.drumSchemes.highhat;

let selectedKick = kick[Math.floor(Math.random() * kick.length)];
let selectedSnare = snare[Math.floor(Math.random() * snare.length)];
while(selectedKick.indexOf(selectedSnare[0]) >= 0) {
  selectedSnare = snare[Math.floor(Math.random() * snare.length)];
}
let selectedHighhat = highhat[Math.floor(Math.random() * highhat.length)];

console.log("selectedKick", selectedKick);
console.log("selectedSnare", selectedSnare);
console.log("selectedHighhat", selectedHighhat);
</script>
</body>
</html>